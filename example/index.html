<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="shortcut icon" href="#" />
    <title>Document</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #webglDOM {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <canvas id='webglDOM'></canvas>
    <script src="../dist/tinyRender.umd.js"></script>
    <script type="module">
        import { GUI } from './utils/dat.gui.module.js';
        // 实例化引擎
        let renderer = new TinyRender.Engine({
            container: 'webglDOM'
        });
        // 添加相机
        let camera = new TinyRender.PerspectiveCamera({
            fov: 75,
            aspect: window.innerWidth / window.innerHeight,
            nearZ: 0.01,
            farZ: 1000
        }, renderer.canvas)
        camera.setPosition([0.20843, -104.146, 30.8784]);
        camera.lookAt = [0, 0, 0];
        renderer.addCamera(camera);
        // 设置相机可交互
        renderer.addCameraOrbitControls();
        // 添加mesh
        let cubeMesh = new TinyRender.Mesh('cube', {
            height: 15,
            width: 15,
            depth: 50
        });
        // 设置mesh位置
        cubeMesh.setPosition([0, 0, 25])
        // let cubeMaterial = new TinyRender.Material({
        //     'color': 'rgba(1.0,0.0,1.0,1.0)',
        //     'opacity': 1.0
        // })
        let lightOptions={
            'ambientIntensity':0.1,
            'specularStrength': 0.5,
            'shininess': 32,
        }

        let cubeMaterial = new TinyRender.PhongMaterial({
            'specularStrength': lightOptions.specularStrength,
            'shininess': lightOptions.shininess,
            'color': 'rgba(0.76470588,1.0,0.8862745098,1.0)',
            'opacity': 1.0
        })

        // 添加材质
        cubeMesh.material = cubeMaterial;
       

        let planeMesh = new TinyRender.Mesh('plane', {
            width: 3000,
            height: 3000
        })
        planeMesh.setPosition([0, 0, 0]);
        // let planeMaterial = new TinyRender.Material({
        //     'color': 'rgba(0.76470588,1.0,0.8862745098,1.0)',
        //     'opacity': 1.0
        // })

        let planeMaterial = new TinyRender.PhongMaterial({
            'specularStrength': lightOptions.specularStrength,
            'shininess': lightOptions.shininess,
            'color': 'rgba(1.0,1.0,1.0,1.0)',
            'opacity': 1.0
        })

        // 添加材质
        planeMesh.material = planeMaterial;
        renderer.addMesh(planeMesh)
        renderer.addMesh(cubeMesh)

        // 灯光设置
        let lightPosition = [-5, -31, 39]
        let light = new TinyRender.SpotLight({
            position: lightPosition,
            color: 'rgb(1.0,1.0,1.0)',
            intensity: 1
        })
        let ambientLight = new TinyRender.AmbientLight({
            intensity: lightOptions.ambientIntensity
        })
        // 可视化灯光
        let lightMesh = new TinyRender.Mesh('cube', {
            height: 5,
            width: 5,
            depth: 5
        });

        let lightMaterial = new TinyRender.Material({
            'color': 'rgba(1.0,0.0,1.0,1.0)',
            'opacity': 1.0,
            'isReceiveShadow':false
        })
        lightMaterial.isReceiveShadow = false;
        lightMesh.material = lightMaterial;
        lightMesh.setPosition(lightPosition)
        lightMesh.userData['isLight'] = true

        renderer.addMesh(lightMesh)
        // 添加环境光
        renderer.addAmbientLight(ambientLight);
        // 添加点光源
        renderer.addLight(light);

        renderer.addShadow(true, {})

        // gui
        const effectController = {
            LightPosition_X: 63.14194837127275,
            LightPosition_Y: -24.90426787498173,
            LightPosition_Z: 84.8102596571634,
            ambientIntensity:lightOptions.ambientIntensity,
            specularStrength:lightOptions.specularStrength,
            shininess:lightOptions.shininess
        };

        function initGUI() {

            const gui = new GUI();

            gui.add(effectController, "LightPosition_X").onChange(function (value) {
                if(renderer.light){
                    lightPosition[0] = value;
                    renderer.light.position[0] = value;
                    lightMesh.setPosition(lightPosition)
                }
            });
            gui.add(effectController, "LightPosition_Y").onChange(function (value) {
                if(renderer.light){
                    lightPosition[1] = value;
                    renderer.light.position[1] = value;
                    lightMesh.setPosition(lightPosition)
                }
            });
            gui.add(effectController, "LightPosition_Z").onChange(function (value) {
                if(renderer.light){
                    lightPosition[2] = value;
                    renderer.light.position[2] = value;
                    lightMesh.setPosition(lightPosition)
                }
            });
            gui.add(effectController, "ambientIntensity").onChange(function (value) {
                if(renderer.light){
                    ambientLight.setIntensity(value)
                }
            });
            gui.add(effectController, "specularStrength").onChange(function (value) {
                if(renderer.light){
                    cubeMaterial.setSpecularStrength(value);
                    planeMaterial.setSpecularStrength(value);
                }
            });
            gui.add(effectController, "shininess").onChange(function (value) {
                if(renderer.light){
                    cubeMaterial.setShininess(value);
                    planeMaterial.setShininess(value);
                }
            });

        }
        initGUI();


        function animate() {
            requestAnimationFrame(animate);
            renderer.render();
            // console.log(renderer.camera.camera)
        }

        // renderer.render();
        animate()
        console.log(renderer)
    </script>
</body>

</html>